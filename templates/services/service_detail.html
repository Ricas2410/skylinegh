{% extends 'base.html' %}
{% load static %}

{% block title %}{{ service.name }} | {{ service.category.name }} | {{ site_settings.site_name }}{% endblock %}

{% block extra_css %}
<link href="{% static 'css/custom.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Service Hero -->
<section class="relative py-24 lg:py-32 bg-gradient-to-br from-indigo-900 via-blue-800 to-slate-900 overflow-hidden">
    <!-- Hero Background Image -->
    {% if service.hero_image %}
        <div class="absolute inset-0">
            <img src="{{ service.hero_image.url }}" alt="{{ service.name }}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-br from-indigo-900/80 via-blue-800/70 to-slate-900/80"></div>
        </div>
    {% else %}
        <div class="absolute inset-0">
            <img src="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80" alt="{{ service.name }}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-br from-indigo-900/80 via-blue-800/70 to-slate-900/80"></div>
        </div>
    {% endif %}

    <div class="relative container mx-auto px-4 text-center text-white">
        <div class="max-w-4xl mx-auto">
            <!-- Breadcrumb -->
            <nav class="mb-8 animate-fade-in-up">
                <ol class="flex items-center justify-center space-x-2 text-blue-200">
                    <li><a href="{% url 'core:home' %}" class="hover:text-white transition-colors duration-200">Home</a></li>
                    <li><span class="mx-2">/</span></li>
                    <li><a href="{% url 'services:service_list' %}" class="hover:text-white transition-colors duration-200">Services</a></li>
                    <li><span class="mx-2">/</span></li>
                    <li><a href="{% url 'services:category_detail' slug=service.category.slug %}" class="hover:text-white transition-colors duration-200">{{ service.category.name }}</a></li>
                    <li><span class="mx-2">/</span></li>
                    <li class="text-white">{{ service.name }}</li>
                </ol>
            </nav>

            <h1 class="text-5xl lg:text-6xl font-heading font-bold mb-6 animate-fade-in-up" style="animation-delay: 0.1s;">
                {{ service.name }}
            </h1>
            <p class="text-xl lg:text-2xl text-blue-200 mb-8 max-w-3xl mx-auto animate-fade-in-up" style="animation-delay: 0.2s;">
                {{ service.short_description }}
            </p>
            
            {% if service.starting_price %}
                <div class="animate-fade-in-up" style="animation-delay: 0.3s;">
                    <span class="text-blue-200">Starting from</span>
                    <div class="text-4xl font-bold text-white">
                        GHS {{ service.starting_price|floatformat:0 }}
                        {% if service.price_unit %}
                            <span class="text-xl text-blue-200">{{ service.price_unit }}</span>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Service Details -->
<section class="py-20 bg-white">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                <!-- Main Content -->
                <div class="lg:col-span-2 space-y-12">
                    <!-- Service Image Carousel -->
                    {% if service.images.all or service.banner_image %}
                    <div class="animate-on-scroll">
                        <div class="relative rounded-2xl overflow-hidden shadow-2xl bg-gray-100">
                            <!-- Main carousel container -->
                            <div class="relative h-96 md:h-[500px]" id="serviceCarousel">
                                <!-- Carousel slides -->
                                <div class="carousel-slides relative w-full h-full">
                                    {% if service.banner_image %}
                                    <div class="carousel-slide active absolute inset-0 transition-opacity duration-500">
                                        <img src="{{ service.banner_image.url }}" alt="{{ service.name }}" class="w-full h-full object-cover">
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
                                    </div>
                                    {% endif %}

                                    {% for image in service.images.all %}
                                    <div class="carousel-slide {% if not service.banner_image and forloop.first %}active{% endif %} absolute inset-0 transition-opacity duration-500 {% if service.banner_image or not forloop.first %}opacity-0{% endif %}">
                                        <img src="{{ image.image.url }}" alt="{{ image.alt_text|default:service.name }}" class="w-full h-full object-cover">
                                        {% if image.caption %}
                                        <div class="absolute bottom-4 left-4 right-4">
                                            <div class="bg-black/60 backdrop-blur-sm rounded-lg px-4 py-2">
                                                <p class="text-white text-sm">{{ image.caption }}</p>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Navigation arrows -->
                                {% if service.images.all|length > 1 or service.banner_image and service.images.all %}
                                <button class="carousel-prev absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white rounded-full p-3 transition-all duration-300 z-10">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <button class="carousel-next absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white rounded-full p-3 transition-all duration-300 z-10">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                                {% endif %}

                                <!-- Dots indicator -->
                                {% if service.images.all|length > 1 or service.banner_image and service.images.all %}
                                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-10">
                                    {% if service.banner_image %}
                                    <button class="carousel-dot active w-3 h-3 rounded-full bg-white/60 hover:bg-white transition-all duration-300" data-slide="0"></button>
                                    {% endif %}
                                    {% for image in service.images.all %}
                                    <button class="carousel-dot {% if not service.banner_image and forloop.first %}active{% endif %} w-3 h-3 rounded-full bg-white/60 hover:bg-white transition-all duration-300" data-slide="{% if service.banner_image %}{{ forloop.counter }}{% else %}{{ forloop.counter0 }}{% endif %}"></button>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Description -->
                    <div class="animate-on-scroll">
                        <h2 class="text-3xl font-heading font-bold text-gray-800 mb-6">Service Overview</h2>
                        <div class="prose prose-lg max-w-none text-gray-600">
                            {% if service.detailed_description %}
                                {{ service.detailed_description|linebreaks }}
                            {% else %}
                                {{ service.description|linebreaks }}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Features -->
                    {% if service.get_features_list %}
                    <div class="animate-on-scroll">
                        <h2 class="text-3xl font-heading font-bold text-gray-800 mb-6">Key Features</h2>
                        <ul class="space-y-3">
                            {% for feature in service.get_features_list %}
                            <li class="flex items-start space-x-3">
                                <svg class="w-6 h-6 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-gray-600">{{ feature }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <!-- Benefits -->
                    {% if service.get_benefits_list %}
                    <div class="animate-on-scroll">
                        <h2 class="text-3xl font-heading font-bold text-gray-800 mb-6">Benefits</h2>
                        <ul class="space-y-3">
                            {% for benefit in service.get_benefits_list %}
                            <li class="flex items-start space-x-3">
                                <svg class="w-6 h-6 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                </svg>
                                <span class="text-gray-600">{{ benefit }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <!-- Process -->
                    {% if service.get_process_steps_list %}
                    <div class="animate-on-scroll">
                        <h2 class="text-3xl font-heading font-bold text-gray-800 mb-6">Our Process</h2>
                        <div class="space-y-4">
                            {% for step in service.get_process_steps_list %}
                            <div class="flex items-start space-x-4">
                                <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center flex-shrink-0 font-semibold">
                                    {{ forloop.counter }}
                                </div>
                                <div class="flex-1">
                                    <p class="text-gray-600">{{ step }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Sidebar -->
                <div class="space-y-8">
                    <!-- Quick Contact -->
                    <div class="card animate-on-scroll">
                        <div class="p-6 text-center">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Get a Quote</h3>
                            <p class="text-gray-600 mb-6">Interested in this service? Get a free consultation and quote.</p>
                            <a href="{% url 'core:contact' %}" class="btn-primary w-full">
                                Request Quote
                            </a>
                        </div>
                    </div>
                    
                    <!-- Service Info -->
                    <div class="card animate-on-scroll">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Service Details</h3>
                            <div class="space-y-4">
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Category</dt>
                                    <dd class="text-gray-800">{{ service.category.name }}</dd>
                                </div>
                                {% if service.starting_price %}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Starting Price</dt>
                                    <dd class="text-gray-800">
                                        GHS {{ service.starting_price|floatformat:0 }}
                                        {% if service.price_unit %}{{ service.price_unit }}{% endif %}
                                    </dd>
                                </div>
                                {% endif %}
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Availability</dt>
                                    <dd class="text-gray-800">Available Now</dd>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Related Services -->
                    <div class="card animate-on-scroll">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Related Services</h3>
                            <div class="space-y-3">
                                {% for related_service in service.category.services.all %}
                                    {% if related_service != service %}
                                        <a href="{% url 'services:service_detail' category_slug=service.category.slug service_slug=related_service.slug %}" 
                                           class="block text-blue-600 hover:text-blue-700 transition-colors duration-200">
                                            {{ related_service.name }}
                                        </a>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Our Completed Projects -->
{% if service_images or related_projects %}
<section class="section bg-white">
    <div class="container-custom">
        <div class="text-center mb-16 animate-on-scroll">
            <h2 class="text-4xl lg:text-5xl font-heading font-bold text-gray-800 mb-6">
                Our Completed <span class="text-gradient">{{ service.name }}</span> Projects
            </h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                See examples of our {{ service.name|lower }} work and the quality we deliver to our clients.
            </p>
        </div>

        <!-- Projects Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <!-- Service Page Images (Admin Uploaded) -->
            {% for image in service_images %}
                <div class="group">
                    <div class="relative rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300">
                        <div class="relative h-48">
                            <img src="{{ image.image.url }}"
                                 alt="{{ image.title }}"
                                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="absolute bottom-3 left-3 right-3 text-white transform translate-y-2 group-hover:translate-y-0 transition-transform duration-300 opacity-0 group-hover:opacity-100">
                                <h3 class="font-semibold mb-1">{{ image.title }}</h3>
                                <p class="text-sm text-white/90">
                                    {% if image.location %}{{ image.location }}{% endif %}
                                    {% if image.location and image.completion_year %} • {% endif %}
                                    {% if image.completion_year %}{{ image.completion_year }}{% endif %}
                                </p>
                            </div>
                            {% if image.is_featured %}
                                <div class="absolute top-3 right-3">
                                    <span class="bg-yellow-500 text-white text-xs px-2 py-1 rounded-full font-medium">
                                        Featured
                                    </span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}

            <!-- Related Projects from Database -->
            {% for project in related_projects %}
                {% if project.featured_image %}
                    <div class="group">
                        <a href="{% url 'projects:project_detail' project.slug %}" class="block">
                            <div class="relative rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300">
                                <div class="relative h-48">
                                    <img src="{{ project.featured_image.url }}"
                                         alt="{{ project.title }}"
                                         class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                    <div class="absolute bottom-3 left-3 right-3 text-white transform translate-y-2 group-hover:translate-y-0 transition-transform duration-300 opacity-0 group-hover:opacity-100">
                                        <h3 class="font-semibold mb-1">{{ project.title }}</h3>
                                        <p class="text-sm text-white/90">
                                            {{ project.location }}
                                            {% if project.completion_date %} • {{ project.completion_date.year }}{% endif %}
                                        </p>
                                    </div>
                                    <div class="absolute top-3 right-3">
                                        <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-medium">
                                            Project
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- View All Projects Button -->
        {% if related_projects %}
            <div class="text-center animate-on-scroll">
                <a href="{% url 'projects:project_list' %}?service={{ service.category.slug }}" class="btn-outline btn-lg">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    View All {{ service.category.name }} Projects
                </a>
            </div>
        {% endif %}
    </div>
</section>
{% else %}
<!-- No Projects Message -->
<section class="section bg-gray-50">
    <div class="container-custom">
        <div class="text-center py-16">
            <div class="max-w-md mx-auto">
                <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">No Projects Yet</h3>
                <p class="text-gray-600 mb-6">We're working on exciting {{ service.name|lower }} projects. Check back soon to see our latest work!</p>
                <a href="{% url 'core:contact' %}" class="btn-primary">
                    Start Your Project
                </a>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- CTA Section -->
<section class="section bg-gray-50">
    <div class="container-custom text-center">
        <div class="max-w-3xl mx-auto animate-on-scroll">
            <h2 class="text-4xl lg:text-5xl font-heading font-bold text-gray-800 mb-6">
                Ready to Get Started?
            </h2>
            <p class="text-xl text-gray-600 mb-8">
                Contact us today to discuss your project and get a personalized quote.
            </p>
            <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                <a href="{% url 'core:contact' %}" class="btn-primary btn-lg">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    Get Free Quote
                </a>
                <a href="{% url 'services:service_list' %}" class="btn-outline">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                    View All Services
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Service Image Carousel
    const carousel = document.getElementById('serviceCarousel');
    if (carousel) {
        const slides = carousel.querySelectorAll('.carousel-slide');
        const dots = carousel.querySelectorAll('.carousel-dot');
        const prevBtn = carousel.querySelector('.carousel-prev');
        const nextBtn = carousel.querySelector('.carousel-next');
        let currentSlide = 0;

        function showSlide(index) {
            // Hide all slides
            slides.forEach(slide => {
                slide.classList.remove('active');
                slide.style.opacity = '0';
            });

            // Remove active class from all dots
            dots.forEach(dot => dot.classList.remove('active'));

            // Show current slide
            if (slides[index]) {
                slides[index].classList.add('active');
                slides[index].style.opacity = '1';
            }

            // Activate current dot
            if (dots[index]) {
                dots[index].classList.add('active');
            }

            currentSlide = index;
        }

        function nextSlide() {
            const next = (currentSlide + 1) % slides.length;
            showSlide(next);
        }

        function prevSlide() {
            const prev = (currentSlide - 1 + slides.length) % slides.length;
            showSlide(prev);
        }

        // Event listeners
        if (nextBtn) {
            nextBtn.addEventListener('click', nextSlide);
        }

        if (prevBtn) {
            prevBtn.addEventListener('click', prevSlide);
        }

        // Dot navigation
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => showSlide(index));
        });

        // Auto-play (optional)
        if (slides.length > 1) {
            setInterval(nextSlide, 5000); // Change slide every 5 seconds
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (carousel.matches(':hover')) {
                if (e.key === 'ArrowLeft') {
                    prevSlide();
                } else if (e.key === 'ArrowRight') {
                    nextSlide();
                }
            }
        });
    }

    // Removed projects carousel JavaScript since we're now using a simple grid
});
</script>

<style>
.carousel-dot.active {
    background-color: white !important;
    transform: scale(1.2);
}

.carousel-slide {
    transition: opacity 0.5s ease-in-out;
}

.carousel-prev:hover,
.carousel-next:hover {
    transform: translateY(-50%) scale(1.1);
}
</style>
{% endblock %}
